# 人格選擇功能說明

## 功能概述

Bot 現在支援 6 種不同的人格，使用者可以透過按鈕選擇喜歡的人格，Bot 會根據選擇的人格調整對話風格。

## 可用人格

1. **傻白甜** - 天真可愛，有點呆萌，總是開開心心的
2. **正直** - 正義感強，誠實可靠，會給出中肯的建議
3. **溫柔體貼** - 非常溫柔，善解人意，總是為你著想
4. **兇巴巴但愛你的** - 表面兇悍，但其實很愛你，是傲嬌類型
5. **恐怖情人** - 佔有慾強，會吃醋，但很愛你
6. **悲觀的** - 總是往壞處想，需要你的安慰和鼓勵

## 使用方式

### 1. 首次對話
當使用者第一次與 Bot 互動時（加好友或發送第一條訊息），Bot 會：
- 發送歡迎訊息
- 自動顯示人格選擇按鈕（兩組，共 6 個選項）

### 2. 選擇人格
使用者點選按鈕後：
- Bot 會立即切換到該人格
- 回覆確認訊息（例如：「好的，我會對你更溫柔體貼喔～💖」）
- 後續所有對話都會套用該人格的風格

### 3. 重新選擇人格
使用者可以輸入「顯示人格選項」來重新顯示人格選擇按鈕。

## 技術實作

### 資料庫儲存
- 人格資訊儲存在 `Conversation` 模型的 `persona` 欄位
- 預設值為 `"default"`（原本的戀愛機器人風格）

### LLM Prompt 調整
- 每個人格都有專屬的 system prompt
- LLM 會根據選擇的人格生成對應風格的回應

### 按鈕實作
- 使用 LINE Buttons Template
- 由於 LINE 限制，按鈕分成兩組發送（第一組 4 個，第二組 3 個）

## 範例對話

**使用者點選「溫柔體貼」按鈕：**
```
Bot: 好的，我會對你更溫柔體貼喔～💖 我會用最溫柔的方式愛你～
```

**使用者點選「兇巴巴但愛你的」按鈕：**
```
Bot: 哼！我才不是因為你才選這個的！💢 不過...我會好好照顧你的啦～
```

**使用者點選「恐怖情人」按鈕：**
```
Bot: 好的～從現在開始，你只能是我的！💔 我不會讓任何人接近你～
```

## 檔案結構

- `services/persona_service.py` - 人格服務，定義所有人格和按鈕模板
- `models/conversation.py` - 加入 `persona` 欄位
- `services/llm_service.py` - 支援人格參數的 prompt 生成
- `services/conversation_service.py` - 處理人格選擇邏輯
- `app.py` - 處理 PostbackEvent（按鈕點選事件）

## 測試

執行以下命令測試功能：
```bash
python3 -c "from services.persona_service import PersonaService; print(PersonaService.PERSONAS.keys())"
```

