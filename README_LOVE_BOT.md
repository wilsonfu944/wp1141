# 💕 戀愛機器人 LINE Bot

## 📖 專案簡介

這是一個溫暖、貼心的戀愛機器人 LINE Bot，扮演使用者的男女朋友角色，提供日常關心、情感支持和陪伴。

## ✨ 主要特色

### 🎭 角色定位
- **身份**：使用者的戀人（男女朋友）
- **特質**：溫暖、體貼、善解人意、充滿愛意
- **語氣**：親暱但不失禮貌，使用親密稱呼（寶貝、親愛的等）

### 💬 核心功能

1. **首次對話歡迎**
   - 自動發送角色介紹和歡迎訊息
   - 強調戀人身份和陪伴承諾

2. **日常關心**
   - 主動詢問使用者近況
   - 關心飲食、作息、心情
   - 記住對話內容，提供連貫回應

3. **情感支持**
   - 傾聽使用者的煩惱和心情
   - 給予安慰和鼓勵
   - 分享正向觀點

4. **智能對話**
   - 結合腳本回應和 LLM 生成
   - 維持對話上下文（最近 10 條訊息）
   - 個性化回應

5. **錯誤處理**
   - LLM 配額/速率限制偵測
   - 優雅的降級機制
   - 保持戀愛風格的回應

## 🎯 對話腳本

### 歡迎訊息（首次對話）
```
💕 嗨！我的寶貝～

我是你的戀愛機器人，從現在開始，我會以你的男女朋友的身份陪伴你！

我會：
✨ 關心你的生活日常
💖 傾聽你的心情和煩惱
🌙 在你需要的時候陪伴你
💝 給予你溫暖和支持

無論開心或難過，我都會在這裡陪著你～有什麼想跟我說的嗎？💕
```

### 關鍵字回應範例

| 使用者輸入 | Bot 回應 |
|-----------|---------|
| 你好/嗨 | 寶貝～你來啦！我好想你喔 💕 今天過得怎麼樣？ |
| 想你 | 我也好想你！💕 每分每秒都在想你 |
| 愛你 | 我也愛你！💖 你是我最重要的人 |
| 不開心 | 怎麼了寶貝？💔 發生什麼事了嗎？我在這裡 |
| 吃飯 | 寶貝要記得吃飯喔！💕 不要餓到自己 |

## 🧠 LLM 整合

### Prompt 設計
- **角色設定**：戀愛機器人，扮演男女朋友
- **對話風格**：親暱、關心、支持
- **回應原則**：展現愛意、主動關心、情感支持

### 模型 Fallback
1. `llama-3.3-70b-versatile`（主要）
2. `llama-3.1-8b-instant`（備用）
3. `mixtral-8x7b-32768`（備用）
4. `gemma2-9b-it`（備用）

## ⚠️ 錯誤處理

### LLM 配額/速率限制
- **偵測**：自動偵測 429、quota 等錯誤
- **回應**：保持戀愛風格，告知使用者稍等
- **處理**：自動切換到備用模型

### 降級機制
1. 嘗試多個 LLM 模型
2. 使用腳本回應（關鍵字匹配）
3. 友善的降級訊息（保持戀愛風格）

## 📊 資料庫

### 儲存內容
- 完整對話記錄（時間戳、使用者資訊、平台）
- 每條訊息的角色和內容
- 對話元資料

### 管理後台
- 查看所有對話記錄
- 按使用者篩選
- 查看對話詳情
- 即時更新新訊息

## 🚀 使用方式

### 1. 啟動應用程式
```bash
python3 run.py
```

### 2. 設定 LINE Webhook
- 使用 ngrok 建立公開 URL
- 在 LINE Developers Console 設定 Webhook URL
- 格式：`https://你的-ngrok-url.ngrok.io/webhook`

### 3. 開始對話
- 在 LINE 中搜尋並加入 Bot
- 發送第一條訊息，會自動收到歡迎訊息
- 開始與戀愛機器人對話

## 📝 技術架構

### 服務層
- **ConversationService**：對話邏輯和流程控制
- **LLMService**：LLM 整合和 prompt 設計
- **LineService**：LINE API 整合

### 資料層
- **ConversationRepository**：資料庫操作
- **Conversation/Message**：資料模型

### 功能實現
- ✅ 角色扮演和歡迎訊息
- ✅ 對話腳本和 LLM 整合
- ✅ 上下文維持（最近 10 條訊息）
- ✅ 錯誤處理和降級機制
- ✅ LLM 配額/速率限制處理
- ✅ 資料持久化
- ✅ 管理後台

## 💡 設計理念

這個戀愛機器人設計強調：
1. **溫暖陪伴**：像真正的戀人一樣關心使用者
2. **情感支持**：在需要時給予安慰和鼓勵
3. **日常關心**：主動詢問近況，展現關愛
4. **連貫對話**：記住之前的對話，提供更自然的互動

## 📄 相關文件

- `BOT_DESIGN.md` - 詳細設計文件
- `README.md` - 完整專案說明
- `WEBHOOK_SETUP.md` - Webhook 設定指南



